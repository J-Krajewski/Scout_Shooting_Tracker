<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Shooting Session</title>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Include the dynamic user search script -->
    <script>
        function searchUsers() {
            var searchQuery = $('#search').val();

            $.ajax({
                url: '/search_users',
                method: 'POST',
                data: { search_query: searchQuery },
                success: function(response) {
                    var users = response.users;
                    var searchResults = $('#searchResults');

                    searchResults.empty();

                    if (users.length > 0) {
                        users.forEach(function(user) {
                            var result = $('<div>').text(user.username);
                            searchResults.append(result);
                        });
                    } else {
                        searchResults.append('<div>No users found</div>');
                    }
                }
            });
        }

        function addUsernameInput() {
            var usernameContainer = $('#username-container');
            var newInput = $('<input>').attr({
                type: 'text',
                name: 'usernames',
                required: true
            });

            usernameContainer.append(newInput);
        }
    </script>
</head>
<body>
    <h1>Add Shooting Session</h1>
    <form method="POST">
        <div id="username-container">
            <!-- Initial input field for username -->
            <label for="username">Username:</label>
            <input type="text" name="usernames" required>
        </div>

        <label for="search">Search for Users:</label>
        <input type="text" id="search" name="search" oninput="searchUsers()">
        <div id="searchResults"></div>

        <button type="button" onclick="addUsernameInput()">Add Username</button>
        <br>
        <label for="distance">Shooting Distance:</label>
        <input type="number" name="distance" required>
        <br>
        <label for="shots_per_target">Shots per Target:</label>
        <input type="number" name="shots_per_target" required>
        <br>
        <label for="target_type">Target Type:</label>
        <input type="text" name="target_type" required>
        <br>
        <label for="description">Description:</label>
        <input type="text" name="description" required>
        <br>
        <button type="submit">Add Session</button>
    </form>
</body>
</html>
